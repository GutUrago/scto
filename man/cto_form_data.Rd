% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/cto_form_data.R
\name{cto_form_data}
\alias{cto_form_data}
\title{Download and Process SurveyCTO Data}
\usage{
cto_form_data(
  req,
  form_id,
  private_key = NULL,
  start_date = as.POSIXct("2000-01-01"),
  status = c("approved", "rejected", "pending"),
  tidy = TRUE
)
}
\arguments{
\item{req}{A \code{httr2_request} object initialized via \code{\link[=cto_request]{cto_request()}}.}

\item{form_id}{String. The unique ID of the SurveyCTO form.}

\item{private_key}{An optional path to a \code{.pem} private key file. Required
if the form is encrypted.}

\item{start_date}{A \code{POSIXct} object. Only submissions received after
this date/time will be downloaded. Defaults to "2000-01-01".}

\item{status}{A character vector of submission statuses to include.
Options are "approved", "rejected", and "pending". Defaults to all three.}

\item{tidy}{Logical. If \code{TRUE}, the function fetches the form's XLSForm
definition and automatically converts columns to their correct types
(numeric, date, datetime), order variables and removes structural fields (groups/notes).}
}
\value{
A \code{data.frame}. If \code{tidy = FALSE}, returns the raw data obtained from
returned JSON object. If \code{tidy = TRUE}, returns a cleaned data with optimized types
and column ordering.
}
\description{
Downloads data from a SurveyCTO server in wide JSON format. It supports
encrypted forms via a private key and offers an automated "tidy" mode that
cleans column types based on the XLSForm definition.
}
\details{
When \code{tidy = TRUE}, this function simplifies the transition from data
collection to data analysis by automatically handling common SurveyCTO
formatting tasks:
\itemize{
\item \strong{Data Type Correction:} Converts text-based numbers, dates,
and timestamps into actual R numeric and date objects. It leverages
\code{\link[readr]{parse_guess}()}, which uses a number of heuristics to
determine which type of vector is "best".
\item \strong{Structural Cleanup:} Removes "administrative" rows and columns
used only for form layout, such as notes, group headers, and repeat markers.
\item \strong{Column Organization:} Reorders columns so that key metadata
(like submission dates) appears first, followed by survey questions
in their original order.
\item \strong{Media Handling:} Cleans links for images, audio, or video files
to show just the filename, making it easier to reference attachments.
\item \strong{Geopoint Splitting:} Splits geopoint fields into four variables,
with _latitude, _longitude, _altitude and _accuracy suffixes.
}
}
\examples{
\dontrun{
# Basic request
req <- cto_request("my_server", "user", "pass")

# Download raw data
raw <- cto_form_data(req, "my_form_id")

# Download and tidy encrypted data
clean <- cto_form_data(req, "my_form_id", "keys/my_key.pem")
}
}
\seealso{
\code{\link[=cto_request]{cto_request()}}, \code{\link[=cto_form_attachment]{cto_form_attachment()}}
}
