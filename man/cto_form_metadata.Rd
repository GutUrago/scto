% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/cto_form_definition.R
\name{cto_form_metadata}
\alias{cto_form_metadata}
\alias{cto_form_definition}
\title{Download SurveyCTO Form Metadata and Definitions}
\usage{
cto_form_metadata(req, form_id)

cto_form_definition(
  req,
  form_id,
  version = NULL,
  load = TRUE,
  dir = tempdir(),
  overwrite = FALSE
)
}
\arguments{
\item{req}{A \code{httr2_request} object created with \code{\link[=cto_request]{cto_request()}}.}

\item{form_id}{A string giving the unique SurveyCTO form ID.}

\item{version}{Optional string specifying a particular form version
to download. If \code{NULL} (default), the currently deployed version is used.}

\item{load}{Logical; if \code{TRUE} (the default), the downloaded XLSForm
is read into R as a list of tibbles (survey, choices, settings).
If \code{FALSE}, the function returns the file path to the downloaded Excel file.}

\item{dir}{A directory where the XLSForm definition file should be saved.
Defaults to \code{\link[=tempdir]{tempdir()}}.}

\item{overwrite}{Logical; if \code{TRUE}, an existing file in \code{dir} will be
overwritten. If \code{FALSE} (the default), the existing file is used.}
}
\value{
\strong{\code{cto_form_metadata()}} returns a list containing the raw JSON metadata,
including keys for \code{deployedGroupFiles} and \code{previousDefinitionFiles}.

\strong{\code{cto_form_definition()}}:
\itemize{
\item If \code{load = TRUE}: Returns a named list of three tibbles (\code{survey}, \code{choices}, \code{settings}).
\item If \code{load = FALSE}: Returns a character string containing the file path.
}
}
\description{
Functions for interacting with SurveyCTO form definitions.
\itemize{
\item \code{cto_form_metadata()} retrieves raw metadata for a form, including
available definition files, version identifiers, and download URLs.
\item \code{cto_form_definition()} downloads the specific XLSForm definition (Excel file)
and optionally parses it into R data frames.
}
}
\details{
\strong{Version Handling}:
When \code{version} is supplied, the function validates it against the available
form versions returned by \code{cto_form_metadata()}. An informative error is raised
if the requested version does not exist.

\strong{Caching}:
If the specific version of the form definition already exists in \code{dir},
it will not be re-downloaded unless \code{overwrite = TRUE}.
}
\examples{
\dontrun{
req <- cto_request("my-org", "user@org.com")

# 1. Get raw metadata
meta <- cto_form_metadata(req, "household_survey")

# 2. Download and read the current form definition
form_def <- cto_form_definition(req, "household_survey")
head(form_def$survey)

# 3. Download a specific historical version (don't read)
file_path <- cto_form_definition(
   req,
   "household_survey",
   version = "20231001",
   load = FALSE
)
}
}
\seealso{
\code{\link[=cto_metadata]{cto_metadata()}} for general server-level metadata.
}
