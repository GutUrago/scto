% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/cto_form_data_attachment.R
\name{cto_form_data_attachment}
\alias{cto_form_data_attachment}
\title{Download Attachments from SurveyCTO Form Data}
\usage{
cto_form_data_attachment(
  req,
  form_id,
  fields = everything(),
  private_key = NULL,
  dir = "media",
  overwrite = FALSE
)
}
\arguments{
\item{req}{A \code{httr2_request} object initialized via \code{\link[=cto_request]{cto_request()}}.}

\item{form_id}{A string specifying the SurveyCTO form ID to inspect.}

\item{fields}{A \code{tidy-select} expression (e.g., \code{everything()}, \code{starts_with("img_")})
specifying which columns should be scanned for attachment URLs. Defaults to \code{everything()}.}

\item{private_key}{Optional. A character string specifying the path to a local
RSA private key file. Required if the form is encrypted.}

\item{dir}{A character string specifying the local directory where files should be saved.
Defaults to \code{"media"}. The directory must exist.}

\item{overwrite}{Logical. If \code{TRUE}, existing files with the same name in \code{dir}
will be overwritten. If \code{FALSE} (the default), existing files are skipped.}
}
\value{
Returns \code{invisible(NULL)}. The function is called for its side effect
of downloading files to the local disk.
}
\description{
Extracts attachment URLs (images, audio, video, signatures) from SurveyCTO form data
and downloads the files to a local directory. This function handles encrypted forms
if a private key is provided.
}
\details{
This function performs the following steps:
\enumerate{
\item Fetches the form data using \code{cto_form_data}.
\item Scans the selected \code{fields} for values matching the standard SurveyCTO API
attachment URL pattern.
\item Downloads the identified files sequentially to the specified \code{dir}.
}
}
\examples{
\dontrun{
library(httr2)

# 1. Create an authenticated request
req <- cto_request("my_server", "username")

# 2. Download all attachments from a form
cto_form_data_attachment(
  req = req,
  form_id = "household_survey_v1",
  dir = "downloads/photos"
)

# 3. Download only specific image fields from an encrypted form
cto_form_data_attachment(
  req = req,
  form_id = "encrypted_health_survey",
  fields = starts_with("image_"),
  private_key = "keys/my_priv_key.pem",
  overwrite = TRUE
)
}
}
\seealso{
\code{\link[=cto_form_data]{cto_form_data()}} for the underlying data retrieval.

\code{\link[httr2:req_perform_sequential]{httr2::req_perform_sequential()}} for the download mechanism.
}
